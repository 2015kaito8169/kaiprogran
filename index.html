<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="https://2015kaito8169.github.io">
    <title>kaiprogran </title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --accent: #58a6ff; --text: #c9d1d9; }
        body { font-family: 'Consolas', monospace; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--panel); padding: 10px 20px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        .main-layout { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .editor-section { flex: 1.2; display: flex; flex-direction: column; }
        .log-section { flex: 0.8; display: flex; flex-direction: column; background: #000; border-radius: 8px; border: 1px solid #30363d; }
        textarea { flex: 1; background: var(--panel); color: #e6edf3; border: 1px solid #30363d; padding: 15px; font-size: 16px; border-radius: 8px; outline: none; resize: none; }
        .toolbar { margin-bottom: 10px; display: flex; gap: 6px; flex-wrap: wrap; }
        button { padding: 6px 12px; border-radius: 6px; border: 1px solid #30363d; cursor: pointer; font-weight: bold; background: #21262d; color: #c9d1d9; }
        #runBtn { background: #238636; color: white; border: none; }
        #logArea { flex: 1; padding: 15px; overflow-y: auto; white-space: pre-wrap; font-size: 14px; line-height: 1.5; }
        .normal { color: #7ee787; } .warn { color: #d29922; } .error { color: #f85149; }
        #helpModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 80%; background: var(--panel); border: 2px solid var(--accent); z-index: 1000; padding: 25px; border-radius: 12px; overflow-y: auto; text-align: center; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:bold; color:var(--accent);">kaiprogran IDE v1.4</div>
    <button onclick="toggleHelp()" style="background:#ffcb6b; color:#000;">èª¬æ˜ã‚’è¦‹ã‚‹</button>
</header>

<div class="main-layout">
    <div class="editor-section">
        <div class="toolbar">
            <button id="runBtn" onclick="runKaiPro()">â–¶ RUN</button>
            <button onclick="saveData(1)">ğŸ’¾ãƒ¡ãƒ¢ãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹1 </button><button onclick="saveData(2)">)ğŸ’¾)">ãƒ¡ãƒ¢ãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹2</button><button onclick="saveData(3)">ğŸ’¾ãƒ¡ãƒ¢ãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹3</button>
            <button onclick="loadData(1)">ğŸ“‚ ãƒ¡ãƒ¢ãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹1ã‚’é–‹ã</button><button onclick="loadData(2)">ğŸ“‚ ãƒ¡ãƒ¢ãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹2ã‚’é–‹ã</button><button onclick="loadData(3)">ğŸ“‚ ãƒ¡ãƒ¢ãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹3ã‚’é–‹ã</button>
            <button onclick="copyRaw('script')">ã‚³ãƒ¼ãƒ‰è¤‡è£½</button>
            <button onclick="copyRaw('log')">ãƒ­ã‚°è¤‡è£½</button>
        </div>
        <textarea id="editor" spellcheck="false" placeholder="ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›...">disp("3ç§’ä»¥å†…ã«[Z]ã‚’æŠ¼ã›ï¼")
{{ "3" }}
keypush"Z" { disp("æˆåŠŸï¼ãŠã‚ã§ã¨ã†ï¼") }
disp("çµ‚äº†ï¼")</textarea>
    </div>
    <div class="log-section"><div id="logArea"></div></div>
</div>

<h2>kaiprogran ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</h2>
<div style="text-align:left; line-height:1.8; font-size:14px; color:#ddd; padding:10px;">
    <p>â— <b>disp("å†…å®¹")</b> : ãƒ­ã‚°ã«å‡ºåŠ›ï¼ˆ""ãªã—ã¯å¤‰æ•°ï¼‰ã€‚</p>
    <p>â— <b>cav("è­¦å‘Š") / ere("ã‚¨ãƒ©ãƒ¼")</b> : é»„è‰²(è­¦å‘Š)ã¨èµ¤è‰²(ã‚¨ãƒ©ãƒ¼)ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã€‚</p>
    <p>â— <b>if (A = B) / else / }}</b> : æ¡ä»¶åˆ†å²ã€‚æœ€å¾Œã¯å¿…ãš <b>}}</b> ã§çµ‚äº†ã€‚æ¯”è¼ƒã¯ <b>=</b> 1ã¤ã€‚</p>
    <p>â— <b>cal("å¼")</b> : è¨ˆç®—ã€‚ cal(var1 "+" var2) ã®ã‚ˆã†ã«å¤‰æ•°ã‚‚çµåˆå¯èƒ½ã€‚</p>
    <p>â— <b>å¤‰æ•° = "å†…å®¹"</b> : å¤‰æ•°ã«ä»£å…¥ã€‚æ—¥æœ¬èªå¤‰æ•°ã‚‚OKã€‚</p>
    <p>â— <b>JS,å¤‰æ•°</b> : JavaScriptãƒ¢ãƒ¼ãƒ‰(++StartScript++)å†…ã®å¤‰æ•°ã‚’ãŠå–ã‚Šå¯„ã›ã€‚</p>
    <p>â— <b>ent,å¤‰æ•°</b> : ãƒ­ã‚°ã«å…¥åŠ›æ¬„ã‚’è¡¨ç¤ºã—ã€çµæœã‚’å¤‰æ•°ã«ä¿å­˜ã€‚</p>
    <p>â— <b>{{ "ç§’æ•°" }}</b> : æŒ‡å®šã—ãŸç§’æ•°ã ã‘ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¸€æ™‚åœæ­¢ã€‚</p>
    <p>â— <b>keypush"A" { å‘½ä»¤ }</b> : Aã‚­ãƒ¼ï¼ˆå¿…ãšå¤§æ–‡å­—ï¼‰ãŒæŠ¼ã•ã‚ŒãŸç¬é–“ã« { } å†…ã‚’å®Ÿè¡Œã€‚Shiftã‚„Enterã‚‚å¯¾å¿œã€‚</p>
    <p>â— <b>{R}["a","b"]</b> : ãƒªã‚¹ãƒˆä½œæˆã€‚ pushã§è¿½åŠ ã€ De="0"ã§å‰Šé™¤ã€ (R="0")ã§æŠ½å‡ºã€‚</p>
    <p>â— <b>icp("å†…å®¹")</b> : ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã€‚ """log"""ã§å…¨ãƒ­ã‚°ã€ """script"""ã§å…¨ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã€‚</p>
    <p>â— <b>++StartScript++</b> : JavaScriptã‚’ç›´æ¥å®Ÿè¡Œï¼ˆã“ã®ä¸­ã§ã¯ <b>com//</b> ã¯ä½¿ç”¨ä¸å¯ï¼‰ã€‚</p>
</div>
<hr style="border:0; border-top:1px solid #444; margin:15px 0;">
<button class="more-btn" onclick="window.open('https://2015kaito8169.github.io/kaides/', '_blank')" style="background:#58a6ff; color:#000; padding:12px 24px; border-radius:8px; font-weight:bold; cursor:pointer; width:100%;">ã‚‚ã£ã¨è©³ã—ã (å…¬å¼Page)</button>


<script>
    let vars = {}; let lists = {}; let jsScope = {};
    const logArea = document.getElementById('logArea');
    const editor = document.getElementById('editor');

    function print(msg, cls="normal") {
        const d = document.createElement('div'); d.className = cls; d.textContent = `> ${msg}`;
        logArea.appendChild(d); logArea.scrollTop = logArea.scrollHeight;
    }

    function toggleHelp() { const m = document.getElementById('helpModal'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; }
    function saveData(n) { localStorage.setItem('kp_s'+n, editor.value); alert(`ä¿å­˜${n}å®Œäº†`); }
    function loadData(n) { const d = localStorage.getItem('kp_s'+n); if(d){editor.value=d; alert(`èª­è¾¼${n}å®Œäº†`);} }
    async function copyRaw(t) { await navigator.clipboard.writeText(t==='log'?logArea.innerText:editor.value); alert(t+"ã‚³ãƒ”ãƒ¼å®Œäº†"); }

    async function executeSingleLine(l) {
        l = l.trim();
        if (!l || l.startsWith("com//")) return true;

        if (l.startsWith("disp(") || l.startsWith("ere(") || l.startsWith("cav(")) {
            let t = l.startsWith("disp") ? "normal" : (l.startsWith("ere") ? "error" : "warn");
            let c = l.match(/\((.*)\)/);
            if(c) {
                let inner = c[1].replace(/"/g,"");
                let out = inner.startsWith("JS,") ? (jsScope[inner.split(",")[1]] || "undefined") : (vars[inner] !== undefined ? vars[inner] : inner);
                print(out, t);
            }
            return true;
        }

        if (l.startsWith("icp(")) {
            let inner = l.match(/\((.*)\)/);
            if(inner) {
                let txt = inner[1] === '"""log"""' ? logArea.innerText : inner[1].replace(/"/g,"");
                navigator.clipboard.writeText(txt);
            }
            return true;
        }
        
        if (l.includes("=")) {
            let p = l.split("="); let n = p[0].trim(); let v = p[1].trim();
            if (v.startsWith("cal(")) {
                let exp = v.match(/\((.*)\)/)[1].replace(/JS,([a-z0-9]+)/gi, (m,v)=>jsScope[v]||0)
                             .replace(/([ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾ a-z0-9]+)/gi, m => vars[m] !== undefined ? vars[m] : m).replace(/"/g,"");
                try { vars[n] = eval(exp); } catch(e) { print("è¨ˆç®—å¤±æ•—", "error"); }
            } else { vars[n] = v.replace(/"/g, ""); }
            return true;
        }

        return false; 
    }

    async function runKaiPro() {
        logArea.innerHTML = ""; vars = {}; lists = {}; jsScope = {};
        const lines = editor.value.split('\n');

        for (let i = 0; i < lines.length; i++) {
            let l = lines[i].trim();
            if (!l || l.startsWith("com//")) continue;

            if (l.startsWith("keypush")) {
                let key = l.match(/"([^"]+)"/)[1].toUpperCase();
                let action = l.match(/\{(.*)\}/); 
                print(`${key}ã‚­ãƒ¼ã‚’å¾…æ©Ÿä¸­...`, "warn");
                
                window.addEventListener('keydown', (e) => {
                    if (e.key.toUpperCase() === key) {
                        if (action) executeSingleLine(action[1]); 
                        else print(`${key}ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ`, "normal");
                    }
                }, { once: true });
                continue;
            }

            if (l.startsWith("{{")) {
                let s = l.match(/\d+/)[0];
                await new Promise(r => setTimeout(r, s * 1000));
                continue;
            }

            let hit = await executeSingleLine(l);
            if (!hit) print(`ã‚¨ãƒ©ãƒ¼: ã€Œ${l}ã€ã¯æ„å‘³ä¸æ˜ã§ã™`, "error");
        }
    }
</script>
</body>
</html>
