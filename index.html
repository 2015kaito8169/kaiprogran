<!DOCTYPE html>
<html lang="ja">
<link rel="icon"href="favicon.png">
	<head>
    <meta charset="UTF-8">
    <title>kaiprogran</title>
    <style>
        :root { --primary: #4C97FF; --accent: #2b7fff; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; background: var(--bg); overflow-x: hidden; }
        
        /* --- ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚¬ãƒ¼ãƒ‰ç”»é¢ --- */
        #mm-auth-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            z-index: 10000; display: flex; justify-content: center; align-items: center;
        }
        .auth-card {
            background: rgba(255, 255, 255, 0.98); padding: 50px; border-radius: 32px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.2); width: 360px; text-align: center;
            backdrop-filter: blur(10px); animation: fadeIn 0.8s ease;
        }
        .logo-icon {
            width: 70px; height: 70px; background: var(--primary); border-radius: 20px;
            display: flex; justify-content: center; align-items: center; margin: 0 auto 20px;
            box-shadow: 0 10px 20px rgba(76, 151, 255, 0.3); color: white; font-size: 38px; font-weight: 900;
        }
        .auth-card h1 { color: #333; margin: 0; font-size: 28px; font-weight: 800; letter-spacing: -1px; }
        .auth-card input {
            width: 100%; padding: 16px; margin: 10px 0;
            border: 2px solid #f0f3f6; border-radius: 14px; box-sizing: border-box;
            font-size: 16px; outline: none; background: #f8fafc; transition: 0.3s;
        }
        .auth-card input:focus { border-color: var(--primary); background: white; }
        .login-btn {
            width: 100%; padding: 18px; background: var(--primary); color: white;
            border: none; border-radius: 14px; cursor: pointer; font-weight: bold; font-size: 17px; margin-top: 20px;
            box-shadow: 0 10px 25px rgba(76, 151, 255, 0.3); transition: 0.3s;
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(76, 151, 255, 0.4); }

        /* --- ğŸ”“ èªè¨¼å¾Œã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ --- */
        #main-app { display: none; min-height: 100vh; animation: contentSlide 0.6s ease; }
        header { background: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .app-logo { color: var(--primary); font-weight: 900; font-size: 26px; }
        .content-body { padding: 40px; max-width: 1000px; margin: 0 auto; line-height: 1.6; color: #444; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes contentSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<!-- ğŸ”‘ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
<div id="mm-auth-overlay">
    <div class="auth-card">
        <div class="logo-icon">m</div>
        <h1>mailmail</h1>
        <p id="mm-status" style="font-size:13px; color:#999; margin-top:10px;">ã™ã¹ã¦ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</p>
ã€€ã€€ã€€ã€€<a style="font-size:13px; color:#0000EE; margin-top:10px;"href="https://2015kaito8169.github.io/mailmaildes/">ã“ã®ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸç†ç”±</a>ã€€
		<input type="text" id="mm-id" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID">
        <input type="password" id="mm-pw" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
        <button class="login-btn" onclick="handleLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <p id="mm-status" style="font-size:13px; color:#999; margin-top:10px;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹</p>
		<a href="https://mailmailservice.onrender.com/">æ–°è¦ç™»éŒ²</a>
		<p id="mm-status" style="font-size:13px; color:#999; margin-top:10px;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚Œã¾ã—ãŸ</p>
		<a href="https://2015kaito8169.github.io/mailmailpassword/">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¾©å…ƒ</a>
        
	</div>
</div>

<!-- ğŸ“¦ éš ã—ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã«è¡¨ç¤º) -->
<div id="main-app">
    <header>
        <div class="app-logo">mailmail</div>
        <div style="display:flex; align-items:center; gap:20px;">
            <span id="user-display" style="font-weight: 800; color: #555;"></span>
            <button onclick="logout()" style="background:#ff4c4c; color:white; border:none; padding:8px 18px; border-radius:10px; cursor:pointer; font-weight:bold;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </header>

    <div class="content-body">
        <!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="https://2015kaito8169.github.io">
    <title>kaiprogran Official IDE</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --accent: #58a6ff; --text: #c9d1d9; }
        body { font-family: 'Consolas', monospace; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--panel); padding: 10px 20px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        .main-layout { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .editor-section { flex: 1.2; display: flex; flex-direction: column; }
        .log-section { flex: 0.8; display: flex; flex-direction: column; background: #000; border-radius: 8px; border: 1px solid #30363d; }
        textarea { flex: 1; background: var(--panel); color: #e6edf3; border: 1px solid #30363d; padding: 15px; font-size: 16px; border-radius: 8px; outline: none; resize: none; }
        .toolbar { margin-bottom: 10px; display: flex; gap: 6px; flex-wrap: wrap; }
        button { padding: 6px 12px; border-radius: 6px; border: 1px solid #30363d; cursor: pointer; font-weight: bold; background: #21262d; color: #c9d1d9; font-size: 13px; }
        #runBtn { background: #238636; color: white; border: none; }
        #logArea { flex: 1; padding: 15px; overflow-y: auto; white-space: pre-wrap; font-size: 14px; line-height: 1.5; }
        .normal { color: #7ee787; } .warn { color: #d29922; } .error { color: #f85149; }
        #helpModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 80%; background: var(--panel); border: 2px solid var(--accent); z-index: 1000; padding: 25px; border-radius: 12px; overflow-y: auto; text-align: center; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:bold; color:var(--accent);">kaiprogran IDE v1.1</div>
    <button onclick="toggleHelp()" style="background:#ffcb6b; color:#000;">èª¬æ˜ã‚’è¦‹ã‚‹</button>
</header>

<div class="main-layout">
    <div class="editor-section">
        <div class="toolbar">
            <button id="runBtn" onclick="runKaiPro()">â–¶ RUN</button>
            <button onclick="saveData(1)">ğŸ’¾ 1</button><button onclick="saveData(2)">ğŸ’¾ 2</button><button onclick="saveData(3)">ğŸ’¾ 3</button>
            <button onclick="loadData(1)">ğŸ“‚ 1</button><button onclick="loadData(2)">ğŸ“‚ 2</button><button onclick="loadData(3)">ğŸ“‚ 3</button>
            <button onclick="copyRaw('script')">ã‚³ãƒ¼ãƒ‰è¤‡è£½</button>
            <button onclick="copyRaw('log')">ãƒ­ã‚°è¤‡è£½</button>
        </div>
        <textarea id="editor" spellcheck="false">com//åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
disp("ã“ã‚“ã«ã¡ã¯")
cav("ã“ã‚“ã«ã¡ã¯")
var=ã“ã‚“ã«ã¡ã¯
ere(var)
cav("kaiprogranã¯mailmail åˆ†å®¶APIã‚’ä½¿ç”¨ã—ã€€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¶ã‚’å°å…¥ã—ã¾ã—ãŸ")
cav("ç¾åœ¨è©¦é¨“å°å…¥ä¸­ã§ã™")
}</textarea>
    </div>
    <div class="log-section"><div id="logArea"></div></div>
</div>

<div id="helpModal">
    <h2>kaiprogran ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</h2>
    <div style="text-align:left; margin-bottom:20px;">
        <p>â— <b>keypush:</b> <code>keypush"Z"</code> ã®å¾Œã« <code>{</code> <code>å†…å®¹</code> <code>}</code> ã¨æ”¹è¡Œã—ã¦æ›¸ãã¾ã™ã€‚</p>
        <p>â— <b>icp:</b> <code>icp("""log""")</code> ã§å…¨ãƒ­ã‚°ã€<code>icp("""script""")</code> ã§å…¨ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã€‚</p>
        <p>â— <b>JSãŠå–ã‚Šå¯„ã›:</b> <code>++StartScript++</code> å†…ã§ <code>this.a = 1</code> ã¨ã—ã€å¤–ã§ <code>JS,a</code> ã§å‘¼ã³å‡ºã—ã€‚</p>
    </div>
    <button onclick="window.open('https://2015kaito8169.github.io', '_blank')" style="background:var(--accent); color:#000; padding:15px 30px; font-size:18px;">ã‚‚ã£ã¨è©³ã—ã</button>
    <button onclick="toggleHelp()" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
</div>

<script>
    let vars = {}; let lists = {}; let jsScope = {};
    const logArea = document.getElementById('logArea');
    const editor = document.getElementById('editor');

    function print(msg, cls="normal") {
        const d = document.createElement('div'); d.className = cls; d.textContent = `> ${msg}`;
        logArea.appendChild(d); logArea.scrollTop = logArea.scrollHeight;
    }

    function toggleHelp() { const m = document.getElementById('helpModal'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; }
    function saveData(n) { localStorage.setItem('kp_s'+n, editor.value); alert(`ã‚¹ãƒ­ãƒƒãƒˆ${n}ã«ä¿å­˜ã—ã¾ã—ãŸ`); }
    function loadData(n) { const d = localStorage.getItem('kp_s'+n); if(d){editor.value=d; alert(`ã‚¹ãƒ­ãƒƒãƒˆ${n}ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);}else{alert("ç©ºã§ã™");} }
    async function copyRaw(t) { await navigator.clipboard.writeText(t==='log'?logArea.innerText:editor.value); alert(t+"ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"); }

    async function runKaiPro() {
        logArea.innerHTML = ""; vars = {}; lists = {}; jsScope = {};
        const lines = editor.value.split('\n');
        let skip = false; let ifRes = false;

        for (let i = 0; i < lines.length; i++) {
            let l = lines[i].trim();
            if (!l || l.startsWith("com//")) continue;
            if (skip && !l.startsWith("else") && !l.includes("}}")) continue;

            let hit = false;

            // disp / ere / cav
            if (l.startsWith("disp(") || l.startsWith("ere(") || l.startsWith("cav(")) {
                let t = l.startsWith("disp") ? "normal" : (l.startsWith("ere") ? "error" : "warn");
                let c = l.match(/\((.*)\)/);
                if(c){
                    let inner = c[1].replace(/"/g,"");
                    let out = inner.startsWith("JS,") ? (jsScope[inner.split(",")[1]] || "undefined") : (vars[inner] !== undefined ? vars[inner] : inner);
                    print(out, t); hit = true;
                }
            }
            // if / else / }}
            else if (l.startsWith("if")) {
                let cond = l.match(/\((.*)\)/)[1].split("=");
                let L = vars[cond[0].trim()] || cond[0].trim().replace(/"/g,"");
                let R = vars[cond[1].trim()] || cond[1].trim().replace(/"/g,"");
                if(L == R){ skip = false; ifRes = true; } else { skip = true; ifRes = false; }
                hit = true;
            }
            else if (l.startsWith("else")) { skip = ifRes; hit = true; }
            else if (l.includes("}}")) { skip = false; hit = true; }
            // keypush (æ„å‘³ä¸æ˜ã‚¨ãƒ©ãƒ¼å›é¿ç‰ˆ)
            else if (l.startsWith("keypush")) {
                let kMatch = l.match(/"([^"]+)"/);
                if(kMatch){
                    let key = kMatch[1].toUpperCase();
                    print(`${key}ã‚­ãƒ¼ ã®å…¥åŠ›ã‚’å¾…æ©Ÿã—ã¾ã™...`, "warn");
                    window.addEventListener('keydown', (e) => {
                        if (e.key.toUpperCase() === key) { print("ã‚­ãƒ¼å…¥åŠ›æˆåŠŸï¼", "normal"); }
                    }, { once: true });
                }
                hit = true;
            }
            // { } ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ãƒ»çµ‚äº† (å˜ä½“ã§ã®ã‚¨ãƒ©ãƒ¼å›é¿)
            else if (l === "{" || l === "}") { hit = true; }
            // icp (ã‚³ãƒ”ãƒ¼)
            else if (l.startsWith("icp(")) {
                let inner = l.match(/\((.*)\)/)[1];
                let txt = "";
                if(inner === '"""log"""') txt = logArea.innerText;
                else if(inner === '"""script"""') txt = editor.value;
                else if(inner.includes('""log"""')) {
                    let idx = inner.match(/\d+/)[0]; txt = logArea.innerText.split('\n')[idx] || "";
                } else {
                    let k = inner.replace(/"/g,""); txt = vars[k] !== undefined ? vars[k] : k;
                }
                navigator.clipboard.writeText(txt); hit = true;
            }
            // JSãƒ¢ãƒ¼ãƒ‰
            else if (l.startsWith("++StartScript++")) {
                let js = ""; i++;
                while(i < lines.length && !lines[i].includes("++endscript++")) { js += lines[i] + "\n"; i++; }
                try {
                    let f = new Function('scope', js + "\nreturn this;");
                    Object.assign(jsScope, f.call(window, jsScope));
                } catch(e) { print(e.message, "error"); }
                hit = true;
            }
            // ä»£å…¥ / cal
            else if (l.includes("=")) {
                let p = l.split("="); let n = p[0].trim(); let v = p[1].trim();
                if (v.startsWith("cal(")) {
                    let exp = v.match(/\((.*)\)/)[1].replace(/JS,([a-z0-9]+)/gi, (m,v)=>jsScope[v]||0)
                                 .replace(/([ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾ a-z0-9]+)/gi, m => vars[m] !== undefined ? vars[m] : m).replace(/"/g,"");
                    try { vars[n] = eval(exp); } catch(e) { print("è¨ˆç®—ä¸å¯", "error"); }
                } else { vars[n] = v.replace(/"/g, ""); }
                hit = true;
            }
            // å¾…æ©Ÿ / ent / ãƒªã‚¹ãƒˆ
            else if (l.startsWith("{{") || l.startsWith("ent") || l.startsWith("{")) {
                if(l.startsWith("{{")){ let s = l.match(/\d+/)[0]; await new Promise(r => setTimeout(r, parseInt(s) * 1000)); }
                if(l.startsWith("ent")){ let r = prompt("å…¥åŠ›"); if(l.includes(",")) vars[l.split(",")[1].trim()]=r; print(r); }
                if(l.startsWith("{") && !l.includes("}}")){
                   let nmMatch = l.match(/\{([^,\]\}]+)/);
                   if(nmMatch){
                       let nm = nmMatch[1];
                       if(l.includes("[")) lists[nm] = JSON.parse(l.match(/\[.*\]/)[0].replace(/'/g, '"'));
                       else if(l.includes("push=")) lists[nm].push(l.match(/"(.*)"/)[1]);
                       else if(l.includes("De")) lists[nm] = [];
                   }
                }
                hit = true;
            }

            if (!hit && !skip) print(`ã‚¨ãƒ©ãƒ¼: ã€Œ${l}ã€ã¯æ„å‘³ä¸æ˜ãªè¨€èªã§ã™`, "error");
        }
    }
</script>
</body>
</html>

        <!-- â˜… ã“ã“ã¾ã§ -->
    </div>
</div>

<script>
    const API_URL = 'https://sparkling-pine-6d7c.kaito20158169.workers.dev';

    // åˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯ (ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶­æŒ)
    (function init() {
        const session = sessionStorage.getItem('mm_access_key');
        if (session) {
            unlockPage(session);
        }
    })();

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function handleLogin() {
        const id = document.getElementById('mm-id').value.trim();
        const pw = document.getElementById('mm-pw').value.trim();
        const status = document.getElementById('mm-status');

        if (!id || !pw) return;

        try {
            // Workerã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ç…§åˆ
            const res = await fetch(`${API_URL}/get?key=auth:${id}`);
            const data = await res.json();

            if (data.value === String(pw)) {
                sessionStorage.setItem('mm_access_key', id);
                unlockPage(id);
            } else {
                status.innerText = "èªè¨¼å¤±æ•—ã€‚IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚";
                status.style.color = "#ff4c4c";
            }
        } catch (e) {
            status.innerText = "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã€‚æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        }
    }

    // ãƒšãƒ¼ã‚¸ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
    function unlockPage(user) {
        document.getElementById('mm-auth-overlay').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('user-display').innerText = "ğŸ‘¤ " + user;
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    function logout() {
        sessionStorage.clear();
        location.reload();
    }
</script>
</body>
</html>
